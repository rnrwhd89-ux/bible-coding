rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // 성경 데이터 - 모든 사용자 읽기 가능
    match /bible/{verseId} {
      allow read: if true;
      allow write: if false; // 관리자만 쓰기 가능 (Admin SDK 사용)
    }

    // 사용자 데이터 - 본인만 읽기/쓰기 가능
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // 채팅방 목록 - 로그인한 사용자 누구나 읽기 가능, 생성/수정 가능
    match /chatRooms/{roomId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update: if request.auth != null;
      allow delete: if request.auth != null &&
                       (resource.data.creatorId == request.auth.uid);

      // 채팅방 내 메시지 - 로그인한 사용자 누구나 읽기/생성 가능
      match /messages/{messageId} {
        allow read: if request.auth != null;
        allow create: if request.auth != null &&
                         request.resource.data.userId == request.auth.uid;
      }
    }
  }
}
